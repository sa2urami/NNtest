<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <script>
            /** @type{CanvasRenderingContext2D} */
            const ctx = canvas.getContext('2d')
            const render = (values) => {
                ctx.clearRect(0, 0, canvas.width, canvas.height)

                const lineHeight = 48
                const xColumns = 200
                for (let y = 0; y <= 9; y++) {
                    ctx.font = '48px monospace'
                    ctx.fillStyle = 'black'
                    ctx.fillText(y, xColumns, y * lineHeight + 35)
                    ctx.fillStyle =
                        values[y] < 0.2
                            ? 'green'
                            : values[y] < 0.6
                            ? 'yellow'
                            : 'red'
                    ctx.fillRect(
                        xColumns + 50,
                        y * lineHeight,
                        values[y] * 50,
                        lineHeight - 15,
                    )
                }
            }

            const resize = () => {
                canvas.width = window.innerWidth
                canvas.height = window.innerHeight
            }

            const socket = new WebSocket('ws://localhost:8080')

            socket.onopen = () => {
                console.log('senc')
                socket.send('message')
            }

            socket.onmessage = ({ data }) => {
                console.log('recieve', data)
                render(JSON.parse(data))
            }

            window.onresize = resize
            resize()
        </script>
    </body>
</html>
